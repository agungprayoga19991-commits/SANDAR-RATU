<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SANDAR-RATU - Sistem Administrasi & Dokumen Kesyahbandaran</title>

  <!-- Lokal: FontAwesome -->
  <link rel="stylesheet" href="libs/fontawesome.min.css">

  <!-- Lokal: QRCodeJS -->
  <script src="libs/qrcode.min.js"></script>

  <!-- Lokal: jsPDF -->
  <script src="libs/jspdf.umd.min.js"></script>

  <!-- Wajib: Google Identity Services & Google API -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f8f9fa;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .login-container {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      max-width: 400px;
      width: 100%;
      overflow: hidden;
    }
    .logo-section {
      text-align: center;
      padding: 40px 30px 20px;
      background: linear-gradient(135deg, #3498db, #1a73e8);
    }
    .logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 24px;
      font-weight: 700;
      color: #333;
      text-decoration: none;
    }
    .logo-icon img {
      width: 40px;
      height: auto;
      border-radius: 3px;
      object-fit: cover;
    }
    .warning-section {
      background: #feffd6;
      border: 1px solid #fff4ce;
      margin: 20px;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    .warning-title {
      background: #ffffff;
      border: 1px solid #ffeaa7;
      color: #000;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      margin-bottom: 15px;
      display: inline-block;
    }
    .login-method-section {
      padding: 20px;
      text-align: center;
    }
    .google-login-btn {
      width: 100%;
      padding: 12px 20px;
      border: 2px solid #e0e0e0;
      background: #fff;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-size: 14px;
      font-weight: 500;
      color: #5f6368;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .google-login-btn:hover {
      border-color: #1a73e8;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .footer-login {
      text-align: center;
      padding: 15px;
      color: #6c757d;
      font-size: 12px;
      border-top: 1px solid #e9ecef;
    }
    /* Dashboard, sidebar, dll (dipendekkan biar fokus ke perbaikan) */
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage" class="login-container">
  <div class="logo-section">
    <a href="#" class="logo">
      <div class="logo-icon">
        <img src="icon.jpeg" alt="Logo">
      </div>
      SANDAR-RATU
    </a>
  </div>
  <div class="warning-section">
    <div class="warning-title">Peringatan</div>
    <div>Halaman ini memerlukan autentikasi.<br>Silahkan klik tombol login di bawah.</div>
  </div>
  <div class="login-method-section">
    <button id="googleLoginBtn" class="google-login-btn">
      <i class="fab fa-google"></i> Login dengan Google
    </button>
  </div>
  <div class="footer-login">Hak Cipta Â© 2025 Sandar-Ratu</div>
</div>

<!-- DASHBOARD -->
<div id="dashboard" style="display:none;">
  <h2>Selamat datang, <span id="userName"></span></h2>
  <img id="userAvatar" alt="User" width="64">
  <button onclick="logout()">Logout</button>
</div>

<script>
const CLIENT_ID = "ISI_CLIENT_ID_KAMU";
const API_KEY = "ISI_API_KEY_KAMU";
const SCOPES = "https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email";

let authInstance = null;
let currentUser = null;

// Init Google API
function initializeGoogle() {
  gapi.load('client:auth2', () => {
    gapi.client.init({
      apiKey: API_KEY,
      clientId: CLIENT_ID,
      discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
      scope: SCOPES
    }).then(() => {
      authInstance = gapi.auth2.getAuthInstance();
      console.log("Google Drive API siap");
    }).catch(err => {
      console.error("Error initializing Google Drive API:", err);
    });
  });
}

// Handle login click
document.getElementById('googleLoginBtn').addEventListener('click', () => {
  google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: SCOPES,
    callback: (tokenResponse) => {
      fetch("https://www.googleapis.com/oauth2/v2/userinfo", {
        headers: { Authorization: "Bearer " + tokenResponse.access_token }
      })
      .then(r => r.json())
      .then(userInfo => {
        currentUser = userInfo;
        document.getElementById("userName").textContent = userInfo.name;
        document.getElementById("userAvatar").src = userInfo.picture;
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
      });
    }
  }).requestAccessToken();
});

// Logout
function logout() {
  if (authInstance && authInstance.isSignedIn.get()) {
    authInstance.signOut();
  }
  currentUser = null;
  document.getElementById("dashboard").style.display = "none";
  document.getElementById("loginPage").style.display = "block";
}

document.addEventListener("DOMContentLoaded", initializeGoogle);
</script>

</body>
</html>
